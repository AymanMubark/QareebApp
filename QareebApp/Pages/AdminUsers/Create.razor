@page "/adminusers/create"
@inject IAdminUserService adminUserService
@inject NavigationManager NavigationManager

<div class="card bg-white">
    <div class="card-header  d-flex justify-content-between align-items-center" style="background-color:white;">
        <h5>
            <i class="oi oi-people mr-2"></i>
            Create Admin User
        </h5>
    </div>
    <div class="card-body">
        <EditForm Model="@model" OnValidSubmit="HandleValidSubmit">
            <div class="form-group row">
                <label for="Name" class="col-md-12 col-form-label">Name</label>
                <div class="col-md-12">
                    <InputText @bind-Value="model.Name" class="form-control" id="Name" />
                    <ValidationMessage For="@(() => model.Name)" />
                </div>
            </div>
            <div class="form-group row">
                <label for="Phone" class="col-md-12 col-form-label">Phone</label>
                <div class="col-md-12">
                    <InputText @bind-Value="model.Phone" class="form-control" id="Phone" />
                    <ValidationMessage For="@(() => model.Phone)" />
                </div>
            </div>
            <div class="form-group row">
                <label for="Email" class="col-md-12 col-form-label">Email</label>
                <div class="col-md-12">
                    <InputText @bind-Value="model.Email" class="form-control" id="Email" />
                    <ValidationMessage For="@(() => model.Email)" />
                </div>
            </div>
            <div class="form-group row">
                <label for="Image" class="col-md-12 col-form-label">Image</label>
                <div class="col-md-12">
                    <InputFile OnChange="@LoadFile" id="" />
                    <ValidationMessage For="@(() => model.Image)" />
                </div>
            </div>
            <div class="form-group row">
                <label for="Name" class="col-md-12 col-form-label">UserName</label>
                <div class="col-md-12">
                    <InputText @bind-Value="model.UserName" class="form-control" id="UserName" />
                    <ValidationMessage For="@(() => model.UserName)" />
                </div>
            </div>
            <div class="form-group row">
                <label for="password" class="col-md-12 col-form-label">Password</label>
                <div class="col-md-12">
                    <InputText type="password" @bind-Value="model.Password" class="form-control" id="password" />
                    <ValidationMessage For="@(() => model.Password)" />
                </div>
            </div>
            <div class="form-group row mb-0">
                <div class="col-md-12">
                    <button type="submit" class="btn btn-success">
                        Add @if (loading)
                        {
                            <span class="spinner-border"></span>
                        }
                    </button>
                </div>
            </div>
        </EditForm>
    </div>
</div>


@code {
    private bool loading;
    protected AddAdminFrom model = new AddAdminFrom();
    private string error;

    private async Task HandleValidSubmit()
    {
        try
        {
            loading = true;
            var reponses = await adminUserService.AddAdminUser(model);
            if (reponses != null)
            {
                NavigationManager.NavigateTo("/adminUsers");
            }
        }
        catch (Exception ex)
        {
            error = ex.Message;
            loading = false;
            StateHasChanged();
        }
    }

    private void LoadFile(InputFileChangeEventArgs e)
    {

        try
        {
            model.Image = e.File;
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
}
